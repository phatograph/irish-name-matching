<%= form_tag match_path, :multipart => true do %>
  <div class="row">
    <div class="col-xs-6">
      <div class="form-group">
        <%= label_tag 'base_names', 'Input 1 (separated by newline)' %>
        <%= text_area_tag 'base_names', params[:base_names], :class => 'form-control', :rows => 5, :tabindex => 1 %>
      </div>
      <div class="form-group">
        <%= label_tag 'file1', 'Or upload a file' %>
        <%= file_field_tag "file1" %>
        <%= @file_content %>
      </div>
    </div>
    <div class="col-xs-6">
      <div class="form-group">
        <%= label_tag 'to_match_names', 'Input 2 (separated by newline)' %>
        <%= text_area_tag 'to_match_names', params[:to_match_names], :class => 'form-control', :rows => 5, :tabindex => 2 %>
      </div>
      <div class="form-group">
        <%= label_tag 'file2', 'Or upload a file' %>
        <%= file_field_tag "file2" %>
      </div>
      <div class="form-group">
        <%= label_tag 'standard_list', 'Or use standard name list' %>
        <div class="checkbox">
          <label>
            <%= check_box_tag 'standard_list' %>
            Use standard list
          </label>
        </div>
      </div>
    </div>
  </div>
  <hr />
  <div class="row">
    <div class="col-xs-6">
      <div class="form-group">
        <label>Matching algorithms</label>
        <% MatchingAlgorithm.descendants.each do |mm| %>
          <div class="checkbox">
            <label>
              <%= check_box_tag "matching_algorithms[#{mm}][name]", mm, has_mm?(params[:matching_algorithms], mm) %>
              <%= number_field_tag "matching_algorithms[#{mm}][weight]", has_mm?(params[:matching_algorithms], mm) ? params[:matching_algorithms].select{|x| x[:name] == mm.to_s }.first[:weight] : mm::WEIGHT, :class => 'mm-value form-control' %>
              <%= mm.to_s.titleize %>
            </label>
          </div>
        <% end %>
      </div>
    </div>
    <div class="col-xs-6">
      <div class="form-group">
        <%= label_tag 'threshold' %>
        <%= number_field_tag 'threshold', params[:threshold] || BaseName::DEFAULT_THRESHOLD, :class => 'form-control', :within => 0.0..1.0, :step => 0.01, :tabindex => 3 %>
      </div>
    </div>
  </div>
  <div class="form-group text-center">
    <div class="form-inline">
      <input class="btn btn-primary" type="submit" value="Submit" />
    </div>
  </div>
<% end %>
<% if @matched_names.present? %>
  <% @matched_names.each do |matched_name| %>
    <div class="panel panel-default">
      <div class="panel-body">
        <h4><%= matched_name.name %></h4>
        <div class="row">
          <% matched_name.to_match_names.each do |tmn| %>
            <div class="col-xs-6">
              <div class="panel panel-default">
                <div class="panel-body">
                  <h4>
                    <span class="name"><%= tmn.name %></span>
                    <span class="label label-success pull-right"><%= tmn.score %></span>
                  </h4>
                  <table class="table">
                    <tr>
                      <th>Algorithm</th>
                      <th>Value</th>
                      <th>Score</th>
                      <th>Weight</th>
                      <th>Total</th>
                    </tr>
                    <% tmn.scores.each do |s| %>
                      <tr>
                        <td><%= s.class.name.titleize %></td>
                        <td><span title="<%= s.label %>"><%= s.value %></span></td>
                        <td><%= s.score %></td>
                        <td>x <%= s.weight %></td>
                        <td><%= s.weighted_score %></td>
                      </tr>
                    <% end %>
                  </table>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
